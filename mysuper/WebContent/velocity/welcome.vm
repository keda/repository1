<STYLE type="text/css">
	.x-grid-row-over .x-grid-cell-inner { 
		font-weight: bold; 
	}
</STYLE>
<h3>欢迎使用Velocity @${currTime}</h3>
<hr>
<div id="data-cnt"></div>
<script type="text/javascript">
  
  Ext.onReady(function(){
	//extjs grid
	Ext.define('TaoTracerMessage', {
        extend: 'Ext.data.Model',
        fields: [
           {name: 'id'},
           {name: 'infoName'},
           {name: 'infoUrl', convert: function(v){return !v ? '' : v;}},
           {name: 'clientIp'},
           {name: 'infoDate'},
		   {name: 'timestamp'}
        ],
        idProperty: 'id'
    });

	/**
     * Custom function used for column renderer
     * @param {Object} val
     */
    function change(val) {
        if (val > 0) {
            return '<span style="color:green;">' + val + '</span>';
        } else if (val < 0) {
            return '<span style="color:red;">' + val + '</span>';
        }
        return val;
    }

    /**
     * Custom function used for column renderer
     * @param {Object} val
     */
    function pctChange(val) {
        if (val > 0) {
            return '<span style="color:green;">' + val + '%</span>';
        } else if (val < 0) {
            return '<span style="color:red;">' + val + '%</span>';
        }
        return val;
    }
	// create the data store
    var store = Ext.create('Ext.data.JsonStore', {
        pageSize: 50,
		storeId: 'storeForMsg',
		model: 'TaoTracerMessage',
        remoteSort: true,
		proxy: {
			type: 'ajax',
            url: '$contextPath/taobao/tracer/query.do',
            reader: {
                type: 'json',
                root: '',
                idProperty: 'id',
				totalProperty: 'total'
            }
		}
		
    });
	
	// create the Grid
    var grid = Ext.create('Ext.grid.Panel', {
		store: Ext.getStore('storeForMsg'),
        stateful: true,
        ##collapsible: true,
		##columnLines: true,
		##draggable: true,
        multiSelect: true,
        stateId: 'stateGrid',
        columns: [
            {
                text     : 'ID',
				type: 'int',
                dataIndex: 'id'
            },
            {
                text     : 'InfoName',
                dataIndex: 'infoName',
				field: {xtype: 'textfield', allowBlank: false}
            },
            {
                text     : 'InfoUrl',
                width    : 430,
                dataIndex: 'infoUrl',
				renderer: function(url) {
					return Ext.String.format('<a href="{0}" style="color: #000;" target="_black">{1}</a>', url, url);
				},
				field: 'textfield'
            },
            {
                text     : 'clientIp',
                dataIndex: 'clientIp'
            },
            {
                text     : 'InfoDate',
                width    : 150,
                dataIndex: 'infoDate'
            },
            {
                text     : 'Timestamp',
                dataIndex: 'timestamp'
            }
        ],
		selType: 'rowmodel', //rowmodel: select row, cellmodel: select cell
        plugins: [
            Ext.create('Ext.grid.plugin.RowEditing', {
                clicksToEdit: 1 //1:stand for click, 2:stand for double-click
            })
        ],
		sorters: ['id','timestamp'],
		features: [{ftype:'grouping'}],
		#*
		listeners: {
			'cellclick': function(ob, td, cellIndex, record, tr, rowIndex){
				Ext.MessageBox.alert('消息', this.columns[cellIndex].text+' : '+td.innerText, function(){
					Ext.Msg.alert('Msg', '我是这个时候执行的...');
					##Ext.fly('ext-gen1056').setStyle({top: '30px'});
				});
			}
		},
		*#
        height: 600,
        ##width: 600,
        ##title: '你的访问记录',
        renderTo: 'data-cnt',
		dockedItems: [{
            xtype: 'pagingtoolbar',
            store: store,   // same store GridPanel is using
            dock: 'bottom',
            displayInfo: true
        }],
		viewConfig: {
            stripeRows: true,
            enableTextSelection: true
        }
		
    });
	store.loadPage(1);
	
  });
</script>
